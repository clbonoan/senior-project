<!DOCTYPE html>
<html>
<head>
  <title>Shadow Check</title>
 <link rel="stylesheet" href="{{ url_for('static', path='/style.css') }}">
 <link rel ="icon" type="image/x-icon" href="{{ url_for('static', path='favicon.png')}}">
</head>
<body>
  <nav class="navbar">
    <div class="nav-left">

      <a href="/">
        <img src="{{ url_for('static', path='/favicon.png') }}" alt="Home" class="nav-logo">
      </a>
    </div>
    <div class="nav-right">
          <a href="https://github.com/clbonoan/senior-project"> Repository </a>
          <a href="/about"> About Us</a>
          <a href="/info"> Information</a>
      </div>
  </nav>

  <h2 > Shadow Check </h2>
  <h3> Upload image to check authenticity</h3>

  <form id="uploadForm">
     <label for="fileInput" class="custom-upload">Choose an Image</label>
    <input type="file" id="fileInput" name="file" hidden/>
    <button type="submit">Analyze</button>
  </form>

  <div id="preview-container">
  <img id="preview" src="" alt="Image preview will appear here">
  </div>

  <div id="result"></div>

  <script>
     const fileInput = document.getElementById("fileInput");
     const preview = document.getElementById("preview");

  // Show image preview immediately when a file is chosen
    fileInput.addEventListener("change", () => {
    const file = fileInput.files[0];
    if (file) {
       const reader = new FileReader();
       reader.onload = function(e) {
         preview.src = e.target.result;
         preview.style.display = "block";
        };
      reader.readAsDataURL(file);
    } else {
      preview.src = "";
      preview.style.display = "none";
    }
  });

    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const fileInput = document.getElementById("fileInput");
      if (!fileInput.files.length) {
        alert("Please select an image first!");
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      // Send to FastAPI
      const response = await fetch("/process/", {
        method: "POST",
        body: formData
      });

      // Read JSON response
      const data = await response.json();

      // Display score
      document.getElementById("result").innerHTML =
        `<b>Tamper Score:</b> ${data.tamper_score.toFixed(2)}<br>
         <small>(0 = normal, 1 = likely tampered)</small>`;
    });
  </script>
</body>
</html>
